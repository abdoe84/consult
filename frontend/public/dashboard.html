<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>REVIVA | Service Requests Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./assets/css/reviva-theme.css">

  <style>
    :root {
      --reviva-purple: #625d9c;
      --reviva-green: #4ca585;
      --reviva-blue: #54c0e8;
      --reviva-bg: #f8fafc;
    }

    body {
      background: var(--reviva-bg);
    }

    /* Reduced background animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .animate-float {
      animation: float 8s ease-in-out infinite;
    }

    .bg-gradient-primary {
      background: linear-gradient(135deg, var(--reviva-purple), var(--reviva-blue));
    }

    .bg-gradient-secondary {
      background: linear-gradient(135deg, var(--reviva-blue), var(--reviva-green));
    }

    .focus-ring {
      --tw-ring-color: var(--reviva-blue);
    }

    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s ease-in-out infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Modern KPI Cards */
    .kpi-card-modern {
      background: white;
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .kpi-card-modern:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
      border-color: rgba(148, 163, 184, 0.5);
    }

    .kpi-icon-wrapper {
      width: 3rem;
      height: 3rem;
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .kpi-card-modern:hover .kpi-icon-wrapper {
      transform: scale(1.1) rotate(5deg);
    }

    .kpi-value-modern {
      font-size: 2.25rem;
      font-weight: 800;
      line-height: 1;
      margin-bottom: 0.5rem;
      letter-spacing: -0.025em;
      transition: all 0.3s ease;
    }

    .kpi-card-modern:hover .kpi-value-modern {
      transform: scale(1.05);
    }

    .kpi-label-modern {
      font-size: 0.875rem;
      font-weight: 500;
      color: #64748b;
      margin-top: 0.25rem;
    }

    @media (max-width: 768px) {
      .kpi-value-modern {
        font-size: 1.875rem;
      }
    }
  </style>
</head>

<body class="min-h-screen text-slate-700">
  <!-- Light Background -->
  <div class="fixed inset-0 pointer-events-none overflow-hidden">
    <div class="absolute top-0 left-0 w-[400px] h-[400px] rounded-full blur-2xl opacity-20 animate-float"
         style="background: radial-gradient(circle, var(--reviva-blue), transparent 70%);"></div>
    <div class="absolute top-1/4 right-0 w-[350px] h-[350px] rounded-full blur-2xl opacity-15"
         style="background: radial-gradient(circle, var(--reviva-green), transparent 70%);"></div>
  </div>

  <header class="sticky top-0 z-10 border-b border-white/30 bg-white/80 backdrop-blur-xl relative shadow-md">
    <div class="max-w-7xl mx-auto px-4 md:px-6 py-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-4 min-w-0">
        <div class="w-10 h-10 md:w-12 md:h-12 rounded-2xl flex items-center justify-center shrink-0 shadow-lg transition-transform hover:scale-105 overflow-hidden p-1.5 bg-gradient-primary">
          <img src="intake/Logo.png" alt="REVIVA Logo" class="w-full h-full object-contain">
        </div>
        <div class="min-w-0">
          <div class="font-bold text-lg md:text-xl tracking-tight truncate bg-gradient-primary bg-clip-text text-transparent">REVIVA</div>
          <div class="text-xs md:text-sm text-slate-600 truncate">Service Requests Dashboard</div>
        </div>
      </div>

      <div class="flex items-center gap-2 md:gap-3">
        <div class="hidden md:flex items-center gap-2 text-sm text-slate-600 bg-white/80 px-3 py-1.5 rounded-xl border border-slate-200/50" id="userChip">
          <span id="userName">Loading...</span>
          <span class="status-badge status-ACTIVE text-xs" id="userRole">‚Äî</span>
        </div>
        <a href="./dashboard.html"
           class="btn-secondary text-sm px-4 py-1.5">
          Requests
        </a>
        <button id="btnLogout" class="btn-primary text-sm px-4 py-1.5">
          Logout
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 md:px-6 py-6 relative">
    <!-- KPIs Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
      <!-- Total Requests Card -->
      <div class="kpi-card-modern group relative overflow-hidden">
        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-purple-400/20 to-blue-400/20 rounded-full blur-2xl -mr-12 -mt-12"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, rgba(98, 93, 156, 0.1), rgba(84, 192, 232, 0.1));">
              <svg class="w-6 h-6" style="color: var(--reviva-purple);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <div class="text-xs font-medium text-slate-500 uppercase tracking-wider">Total</div>
          </div>
          <div class="kpi-value-modern" id="kpiTotal" style="color: var(--reviva-purple);">0</div>
          <div class="kpi-label-modern">Service Requests</div>
        </div>
      </div>

      <!-- Pending Review Card -->
      <div class="kpi-card-modern group relative overflow-hidden">
        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-blue-400/20 to-cyan-400/20 rounded-full blur-2xl -mr-12 -mt-12"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(6, 182, 212, 0.1));">
              <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="text-xs font-medium text-blue-600 uppercase tracking-wider">Pending</div>
          </div>
          <div class="kpi-value-modern text-blue-600" id="kpiPending">0</div>
          <div class="kpi-label-modern">Awaiting Review</div>
        </div>
      </div>

      <!-- Accepted Card -->
      <div class="kpi-card-modern group relative overflow-hidden">
        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-emerald-400/20 to-teal-400/20 rounded-full blur-2xl -mr-12 -mt-12"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(20, 184, 166, 0.1));">
              <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="text-xs font-medium text-emerald-600 uppercase tracking-wider">Accepted</div>
          </div>
          <div class="kpi-value-modern text-emerald-600" id="kpiAccepted">0</div>
          <div class="kpi-label-modern">Consultant Approved</div>
        </div>
      </div>

      <!-- Rejected Card -->
      <div class="kpi-card-modern group relative overflow-hidden">
        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-red-400/20 to-rose-400/20 rounded-full blur-2xl -mr-12 -mt-12"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="kpi-icon-wrapper" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(244, 63, 94, 0.1));">
              <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="text-xs font-medium text-red-600 uppercase tracking-wider">Rejected</div>
          </div>
          <div class="kpi-value-modern text-red-600" id="kpiRejected">0</div>
          <div class="kpi-label-modern">Consultant Declined</div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex flex-wrap gap-2 mb-6">
      <button class="tab-btn active" data-tab="requests">Service Requests</button>
      <button class="tab-btn" data-tab="projects">Projects</button>
    </div>

    <!-- Main Card - Requests -->
    <section id="tab-requests" class="card">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <div>
          <h1 class="text-2xl font-bold" style="color: var(--reviva-purple);">Service Requests</h1>
          <div class="text-sm text-slate-600 mt-1">Manage and track all service requests in real-time</div>
        </div>
        <div class="flex items-center gap-2">
          <div class="text-xs text-slate-500" id="lastRefresh">‚Äî</div>
          <button id="btnRefresh" class="btn-secondary text-sm px-3 py-1.5">üîÑ Refresh</button>
          <button id="btnExport" class="btn-secondary text-sm px-3 py-1.5">üì• Export CSV</button>
        </div>
      </div>

      <!-- Filters Bar -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-3 mb-4 p-4 bg-slate-50/50 rounded-xl border border-slate-200/50">
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">Status</label>
          <select id="filterStatus" class="input-field focus-ring">
            <option value="">All Statuses</option>
            <option value="PENDING_REVIEW">Pending Review</option>
            <option value="CONSULTANT_ACCEPTED">Accepted</option>
            <option value="CONSULTANT_REJECTED">Rejected</option>
          </select>
        </div>

        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">Service Type</label>
          <input id="filterServiceType" placeholder="e.g. EIA..." class="input-field focus-ring" />
        </div>

        <div class="md:col-span-3">
          <label class="block text-xs font-medium text-slate-600 mb-1">Search</label>
          <input id="filterQ" placeholder="Search by title, reference..." class="input-field focus-ring" />
        </div>

        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">Sort By</label>
          <select id="filterSort" class="input-field focus-ring">
            <option value="created_desc">Created (Newest)</option>
            <option value="created_asc">Created (Oldest)</option>
            <option value="priority_desc">Priority (High‚ÜíLow)</option>
            <option value="priority_asc">Priority (Low‚ÜíHigh)</option>
            <option value="status">Status</option>
          </select>
        </div>

        <div class="md:col-span-3 flex items-end gap-2">
          <button id="btnClearFilters" class="btn-secondary flex-1 text-sm">Clear Filters</button>
        </div>
      </div>

      <div id="errorBox" class="hidden mt-4 rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"></div>

      <!-- Table -->
      <div class="overflow-hidden rounded-xl border border-slate-200 shadow-sm">
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-gradient-primary sticky top-0 z-10">
              <tr>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Reference</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left min-w-[200px] text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Title</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Service</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Priority</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Status</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Created</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-right text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Action</th>
              </tr>
            </thead>
            <tbody id="rows" class="divide-y divide-slate-200/50 bg-white">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Loading Skeleton -->
      <div id="skeletonRows" class="hidden">
        <div class="border border-slate-200 rounded-xl p-4 space-y-3">
          <div class="skeleton h-12 rounded"></div>
          <div class="skeleton h-12 rounded"></div>
          <div class="skeleton h-12 rounded"></div>
        </div>
      </div>

      <!-- Empty State -->
      <div id="empty" class="hidden mt-6 text-center py-12">
        <div class="empty-state-icon text-5xl mb-3">üìã</div>
        <div class="empty-state-text font-medium text-base">No requests found</div>
        <div class="empty-state-text text-sm mt-1">Try adjusting your filters</div>
      </div>

      <!-- Pagination -->
      <div id="pagination" class="hidden mt-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2 text-sm text-slate-600">
          <span>Page</span>
          <span id="currentPage">1</span>
          <span>of</span>
          <span id="totalPages">1</span>
          <span class="mx-2">‚Ä¢</span>
          <span id="pageInfo">Showing 0-0 of 0</span>
        </div>
        <div class="flex items-center gap-2">
          <select id="pageSize" class="input-field text-sm py-1.5 px-3 w-20">
            <option value="10">10</option>
            <option value="25" selected>25</option>
            <option value="50">50</option>
          </select>
          <span class="text-sm text-slate-600">per page</span>
          <button id="btnPrevPage" class="btn-secondary text-sm px-3 py-1.5">‚Üê Prev</button>
          <button id="btnNextPage" class="btn-secondary text-sm px-3 py-1.5">Next ‚Üí</button>
        </div>
      </div>
    </section>

    <!-- Projects Tab -->
    <section id="tab-projects" class="card hidden">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <div>
          <h1 class="text-2xl font-bold" style="color: var(--reviva-purple);">Projects</h1>
          <div class="text-sm text-slate-600 mt-1">Manage and track all projects</div>
        </div>
        <div class="flex items-center gap-2">
          <div class="text-xs text-slate-500" id="lastRefreshProjects">‚Äî</div>
          <button id="btnRefreshProjects" class="btn-secondary text-sm px-3 py-1.5">üîÑ Refresh</button>
          <button id="btnExportProjects" class="btn-secondary text-sm px-3 py-1.5">üì• Export CSV</button>
        </div>
      </div>

      <!-- Projects Filters -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-3 mb-4 p-4 bg-slate-50/50 rounded-xl border border-slate-200/50">
        <div class="md:col-span-3">
          <label class="block text-xs font-medium text-slate-600 mb-1">Search</label>
          <input id="filterProjectsQ" placeholder="Search by name, code..." class="input-field focus-ring" />
        </div>
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">Status</label>
          <select id="filterProjectsStatus" class="input-field focus-ring">
            <option value="">All Statuses</option>
            <option value="DRAFT">DRAFT</option>
            <option value="ACTIVE">ACTIVE</option>
            <option value="CLOSED">CLOSED</option>
            <option value="ARCHIVED">ARCHIVED</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-xs font-medium text-slate-600 mb-1">Sort By</label>
          <select id="filterProjectsSort" class="input-field focus-ring">
            <option value="created_desc">Created (Newest)</option>
            <option value="created_asc">Created (Oldest)</option>
            <option value="name">Name</option>
            <option value="status">Status</option>
          </select>
        </div>
        <div class="md:col-span-5 flex items-end gap-2">
          <button id="btnClearProjectsFilters" class="btn-secondary flex-1 text-sm">Clear Filters</button>
        </div>
      </div>

      <div id="errorBoxProjects" class="hidden mt-4 rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-700"></div>

      <!-- Projects Table -->
      <div class="overflow-hidden rounded-xl border border-slate-200 shadow-sm">
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-gradient-primary sticky top-0 z-10">
              <tr>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Project Code</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left min-w-[200px] text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Name</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Status</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Value (SAR)</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-left text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Created</th>
                <th class="px-4 md:px-5 py-3 font-semibold text-right text-white tracking-wider" style="color: #FFFFFF; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">Action</th>
              </tr>
            </thead>
            <tbody id="projectsRows" class="divide-y divide-slate-200/50 bg-white">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Projects Loading Skeleton -->
      <div id="skeletonProjectsRows" class="hidden">
        <div class="border border-slate-200 rounded-xl p-4 space-y-3">
          <div class="skeleton h-12 rounded"></div>
          <div class="skeleton h-12 rounded"></div>
          <div class="skeleton h-12 rounded"></div>
        </div>
      </div>

      <!-- Projects Empty State -->
      <div id="emptyProjects" class="hidden mt-6 text-center py-12">
        <div class="empty-state-icon text-5xl mb-3">üìÅ</div>
        <div class="empty-state-text font-medium text-base">No projects found</div>
        <div class="empty-state-text text-sm mt-1">Try adjusting your filters</div>
      </div>

      <!-- Projects Pagination -->
      <div id="paginationProjects" class="hidden mt-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2 text-sm text-slate-600">
          <span>Page</span>
          <span id="currentPageProjects">1</span>
          <span>of</span>
          <span id="totalPagesProjects">1</span>
          <span class="mx-2">‚Ä¢</span>
          <span id="pageInfoProjects">Showing 0-0 of 0</span>
        </div>
        <div class="flex items-center gap-2">
          <select id="pageSizeProjects" class="input-field text-sm py-1.5 px-3 w-20">
            <option value="10">10</option>
            <option value="25" selected>25</option>
            <option value="50">50</option>
          </select>
          <span class="text-sm text-slate-600">per page</span>
          <button id="btnPrevPageProjects" class="btn-secondary text-sm px-3 py-1.5">‚Üê Prev</button>
          <button id="btnNextPageProjects" class="btn-secondary text-sm px-3 py-1.5">Next ‚Üí</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast Container -->
  <div id="toast" class="toast hidden"></div>

  <script type="module" src="./assets/js/pages/dashboard.js"></script>
</body>
</html>
