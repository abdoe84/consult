<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Request Details | REVIVA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --scampi: #635d9e;           /* Primary */
      --patina: #66a286;           /* Success */
      --picton-blue: #54c0e8;      /* Secondary */
      --fountain-blue: #5bb4c2;    /* Accent */
      --breaker-bay: #63a597;      /* Accent */
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      background: #f8fafc;
    }

    body[dir="rtl"], [lang="ar"] {
      font-family: 'Tajawal', 'Inter', sans-serif;
    }

    /* Skeleton Loader */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }

    /* Card Styles */
    .card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05), 0 1px 2px 0 rgba(0, 0, 0, 0.03);
      transition: all 0.2s ease;
    }

    .card:hover {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
    }

    /* Professional Status Badge */
    .status-badge {
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.025em;
      text-transform: uppercase;
      border: 1px solid;
    }

    .status-badge.pending {
      background: #fef3c7;
      border-color: #fcd34d;
      color: #92400e;
    }

    .status-badge.accepted {
      background: #d1fae5;
      border-color: #6ee7b7;
      color: #065f46;
    }

    .status-badge.rejected {
      background: #fee2e2;
      border-color: #fca5a5;
      color: #991b1b;
    }

    /* Sticky Action Bar */
    .action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e2e8f0;
      box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.08);
      z-index: 50;
      padding: 16px 24px;
    }
  </style>
</head>

<body class="text-slate-700 pb-32">
  <!-- Subtle Background -->
  <div class="fixed inset-0 pointer-events-none overflow-hidden">
    <div class="absolute top-0 left-0 w-[600px] h-[600px] rounded-full blur-3xl opacity-20"
         style="background: radial-gradient(circle, var(--picton-blue), transparent 70%);"></div>
    <div class="absolute top-1/4 right-0 w-[500px] h-[500px] rounded-full blur-3xl opacity-15 animate-float"
         style="background: radial-gradient(circle, var(--patina), transparent 70%);"></div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-40 border-b border-slate-200 bg-white/95 backdrop-blur-sm shadow-sm">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-4 min-w-0">
        <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0 shadow-sm overflow-hidden p-1.5"
             style="background: linear-gradient(135deg, var(--scampi), var(--picton-blue));">
          <img src="intake/Logo.png" alt="REVIVA Logo" class="w-full h-full object-contain">
        </div>
        <div class="min-w-0">
          <div class="font-bold text-lg tracking-tight truncate" style="color: var(--scampi);">REVIVA</div>
          <div class="text-xs text-slate-500 truncate">Request Details</div>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <div id="roleChip" class="text-xs font-semibold px-3 py-1.5 rounded-lg bg-slate-100 text-slate-700">
          UNKNOWN
        </div>
        <a href="dashboard.html" class="text-sm px-4 py-2 rounded-lg border border-slate-300 bg-white hover:bg-slate-50 transition-colors" style="color: var(--scampi);">
          Home
        </a>
        <button id="btnBack" class="text-sm px-4 py-2 rounded-lg border border-slate-300 bg-white hover:bg-slate-50 transition-colors" style="color: var(--scampi);">
          ‚Üê Back
        </button>
        <button id="btnLogout" class="text-sm px-4 py-2 rounded-lg text-white hover:opacity-90 transition-opacity"
                style="background: var(--scampi);">
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-6 py-8 relative">
    <!-- Error Message -->
    <div id="errorBox" class="hidden mb-6 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"></div>

    <!-- Request Header -->
    <div class="mb-6">
      <div class="flex items-center justify-between mb-2">
        <h1 class="text-2xl font-bold" style="color: var(--scampi);">
          Request <span id="refNo2" class="text-slate-600">N/A</span>
        </h1>
      </div>
      <div class="text-sm text-slate-500" id="sessionLine">User ‚Ä¢ UNKNOWN</div>
    </div>

    <!-- Two-Column Grid Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left Column: Service Details, Description, Attachments -->
      <div class="lg:col-span-2 space-y-6">
        <!-- Service Details Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--scampi);">
              ‚öôÔ∏è
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Service Details</h2>
          </div>
          <div class="space-y-4 pl-0">
            <div class="flex items-start justify-between py-3 border-b border-slate-100 last:border-0">
              <div class="text-sm font-medium text-slate-500 uppercase tracking-wide">Service Type</div>
              <div class="text-base font-semibold text-slate-800 text-right" id="serviceType">N/A</div>
            </div>
            <div class="flex items-start justify-between py-3 border-b border-slate-100 last:border-0">
              <div class="text-sm font-medium text-slate-500 uppercase tracking-wide">Priority</div>
              <div class="text-base font-semibold text-slate-800 text-right" id="priority">N/A</div>
            </div>
            <div class="flex items-start justify-between py-3 border-b border-slate-100 last:border-0">
              <div class="text-sm font-medium text-slate-500 uppercase tracking-wide">Created</div>
              <div class="text-base font-semibold text-slate-800 text-right" id="createdAt">N/A</div>
            </div>
          </div>
        </div>

        <!-- Description Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--picton-blue);">
              üìù
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Description</h2>
          </div>
          <div id="description" class="prose prose-sm max-w-none">
            <div class="text-sm text-slate-400 italic">Loading...</div>
          </div>
        </div>

        <!-- Attachments Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--fountain-blue);">
              üìé
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Attachments</h2>
          </div>
          <div id="attachments" class="space-y-3">
            <div class="skeleton h-16 rounded-xl"></div>
            <div class="skeleton h-16 rounded-xl"></div>
          </div>
        </div>
      </div>

      <!-- Right Column: Status, Client Profile, Time Logs -->
      <div class="space-y-6">
        <!-- Request Status Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--breaker-bay);">
              üè∑Ô∏è
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Status</h2>
          </div>
          <div class="space-y-4">
            <div>
              <div class="text-xs font-medium text-slate-500 uppercase tracking-wide mb-2">Reference</div>
              <div class="font-mono text-base font-bold text-slate-800" id="refNo">N/A</div>
            </div>
            <div>
              <div class="text-xs font-medium text-slate-500 uppercase tracking-wide mb-2">Status</div>
              <div id="reqStatus" class="status-badge pending inline-flex items-center gap-1.5">
                <span>‚è±</span>
                <span>PENDING_REVIEW</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Title Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--picton-blue);">
              üìã
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Title</h2>
          </div>
          <div class="text-base font-semibold leading-relaxed" style="color: var(--scampi);" id="title">N/A</div>
        </div>

        <!-- Client Profile Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--patina);">
              üë§
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Client Profile</h2>
          </div>
          <div id="clientInfo" class="space-y-4">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- Time Logs Card -->
        <div class="card p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-sm font-bold shrink-0"
                 style="background: var(--fountain-blue);">
              ‚è∞
            </div>
            <h2 class="text-lg font-semibold text-slate-800">Time Logs</h2>
          </div>
          <div id="timeLogs" class="space-y-3 text-sm text-slate-600">
            <div class="flex items-center justify-between py-2 border-b border-slate-100">
              <span class="text-slate-500">Created</span>
              <span class="font-medium" id="createdTime">‚Äî</span>
            </div>
            <div class="flex items-center justify-between py-2 border-b border-slate-100">
              <span class="text-slate-500">Last Updated</span>
              <span class="font-medium" id="updatedTime">‚Äî</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Offer Section -->
    <div id="offerSection" class="mt-8 card overflow-hidden">
      <div class="px-6 py-4 text-white" style="background: var(--scampi);">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold">Offer</h3>
          <button id="btnOpenOfferDraft" class="hidden px-4 py-2 text-xs font-medium text-white rounded-lg border border-white/30 bg-white/20 hover:bg-white/30 transition-colors">
            Open Draft
          </button>
        </div>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
            <div class="text-xs font-medium text-slate-500 mb-1">Offer Status</div>
            <div class="font-bold text-slate-800" id="offerStatus">N/A</div>
          </div>
          <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
            <div class="text-xs font-medium text-slate-500 mb-1">Offer ID</div>
            <div class="font-bold text-slate-800 break-all text-sm" id="offerId">N/A</div>
          </div>
          <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
            <div class="text-xs font-medium text-slate-500 mb-1">Updated</div>
            <div class="font-bold text-slate-800" id="offerUpdated">N/A</div>
          </div>
        </div>
        <div class="mt-4 flex justify-end">
          <a id="btnOfferReview" class="hidden inline-flex items-center px-4 py-2 text-sm font-medium text-white rounded-lg hover:opacity-90 transition-opacity"
             style="background: var(--patina);"
             href="#">
            Review Offer ‚Üí
          </a>
        </div>
      </div>
    </div>

    <!-- Technical Offer Section (for Manager/Admin) -->
    <div id="technicalOfferSection" class="hidden mt-6 card p-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold mb-1" style="color: var(--scampi);">Technical Offer</h2>
          <p class="text-sm text-slate-600">Detailed technical specifications and scope of work</p>
        </div>
        <span class="text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-lg">View Only</span>
      </div>
      <div id="technicalOfferContent" class="space-y-4"></div>
    </div>

    <!-- Financial Offer Section (for Manager/Admin) -->
    <div id="financialOfferSection" class="hidden mt-6 card p-6">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold mb-1" style="color: var(--patina);">Financial Offer</h2>
          <p class="text-sm text-slate-600">Complete breakdown with totals</p>
        </div>
        <span class="text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-lg">SAR ‚Ä¢ VAT 15%</span>
      </div>
      <div id="financialOfferContent"></div>
    </div>

    <!-- Project Section -->
    <div id="projectSection" class="mt-6 card overflow-hidden">
      <div class="px-6 py-4 text-white" style="background: var(--fountain-blue);">
        <h3 class="text-lg font-semibold">Project</h3>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
            <div class="text-xs font-medium text-slate-500 mb-1">Project Status</div>
            <div class="font-bold text-slate-800" id="projectStatus">N/A</div>
          </div>
          <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
            <div class="text-xs font-medium text-slate-500 mb-1">Project ID</div>
            <div class="font-bold text-slate-800 break-all text-sm" id="projectId">N/A</div>
          </div>
          <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
            <div class="text-xs font-medium text-slate-500 mb-1">Updated</div>
            <div class="font-bold text-slate-800" id="projectUpdated">N/A</div>
          </div>
        </div>
        <div class="mt-4 flex gap-3 justify-end flex-wrap">
          <button id="btnRetryCreateProject" class="hidden px-4 py-2 rounded-lg bg-amber-500 text-white font-semibold hover:opacity-90 transition-opacity">
            Retry Create Project
          </button>
          <button id="btnEditProject" class="hidden px-4 py-2 rounded-lg border border-slate-300 bg-white font-semibold hover:bg-slate-50 transition-colors" style="color: var(--scampi);">
            Edit Project Title
          </button>
          <button id="btnCancelProject" class="hidden px-4 py-2 rounded-lg bg-red-600 text-white font-semibold hover:opacity-90 transition-opacity">
            Cancel Project
          </button>
          <button id="btnOpenProject" class="hidden px-4 py-2 rounded-lg bg-emerald-600 text-white font-semibold hover:opacity-90 transition-opacity">
            Open Project
          </button>
        </div>
        <div id="noProject" class="mt-4 text-center py-8 text-slate-400">
          <div class="text-4xl mb-2">üìÑ</div>
          <div class="font-medium">No project created yet</div>
          <div class="text-xs mt-1">for this request</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Sticky Bottom Action Bar (replaces Consultant Review box) -->
  <div id="consultantActions" class="hidden action-bar">
    <div class="max-w-7xl mx-auto flex items-center justify-between gap-4 flex-wrap">
      <div class="flex-1 min-w-0">
        <div class="text-sm font-semibold text-slate-800">Consultant Review</div>
        <div class="text-xs text-slate-500 mt-0.5">Accept or reject this request (reject requires reason)</div>
      </div>
      <div class="flex items-center gap-3">
        <button id="btnAccept" class="px-6 py-2.5 text-sm font-medium text-white rounded-lg hover:opacity-90 transition-opacity"
                style="background: var(--patina);">
          Accept
        </button>
        <button id="btnRejectToggle" class="px-6 py-2.5 text-sm font-medium text-red-600 rounded-lg border border-red-300 bg-red-50 hover:bg-red-100 transition-colors">
          Reject
        </button>
      </div>
    </div>

    <!-- Reject Reason Box (appears when Reject is clicked) -->
    <div id="rejectBox" class="hidden mt-4 max-w-7xl mx-auto">
      <label class="block text-sm font-medium text-slate-700 mb-2">Reject reason (required)</label>
      <textarea id="rejectReason" rows="3"
                class="w-full rounded-lg border border-slate-300 px-4 py-2.5 text-sm outline-none focus:ring-2 focus:ring-[var(--scampi)] focus:ring-offset-1 transition-all"
                placeholder="Write the rejection reason..."></textarea>
      <div class="mt-3 flex items-center gap-3">
        <button id="btnRejectConfirm" class="px-6 py-2.5 text-sm font-medium text-white rounded-lg bg-red-600 hover:opacity-90 transition-opacity">
          Confirm Reject
        </button>
        <button id="btnRejectCancel" class="px-6 py-2.5 text-sm font-medium text-slate-700 rounded-lg border border-slate-300 bg-white hover:bg-slate-50 transition-colors">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="./assets/js/pages/request-details/index.js?v=20260110b"></script>
</body>
</html>
